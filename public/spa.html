<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>üßñ‚Äç‚ôÄÔ∏è Spa ‚Äì Face Recognition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="/socket.io/socket.io.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: #000;
      color: #fff;
      text-align: center;
    }

    h1 {
      margin: 10px 0;
      font-size: 22px;
    }

    select, button {
      padding: 10px;
      margin: 6px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
    }

    button {
      background: #8e24aa;
      color: #fff;
    }

    #videoBox {
      position: relative;
      margin: 10px auto;
      width: 90%;
      max-width: 360px;
      border: 4px solid #ce93d8;
      border-radius: 16px;
      box-shadow: 0 0 20px #ce93d8;
    }

    video {
      width: 100%;
      border-radius: 12px;
    }

    #status {
      margin-top: 8px;
      font-size: 14px;
      color: #ce93d8;
    }
  </style>
</head>

<body>

  <h1>üßñ‚Äç‚ôÄÔ∏è SPA EXPERIENCE</h1>

  <select id="cameraSelect"></select><br />
  <button id="startCamBtn">üé• B·∫≠t camera</button>

  <div id="videoBox">
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>
  </div>

  <button id="confirmBtn" disabled>‚úÖ X√°c nh·∫≠n Spa</button>

  <div id="status">Ch∆∞a b·∫≠t camera</div>

<script>
const socket = io();
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const cameraSelect = document.getElementById("cameraSelect");
const startCamBtn = document.getElementById("startCamBtn");
const confirmBtn = document.getElementById("confirmBtn");
const statusText = document.getElementById("status");

let stream;

async function loadCam() {
  const devices = await navigator.mediaDevices.enumerateDevices();
  cameraSelect.innerHTML = "";
  devices.filter(d => d.kind === "videoinput").forEach((d, i) => {
    const o = document.createElement("option");
    o.value = d.deviceId;
    o.text = d.label || `Camera ${i + 1}`;
    cameraSelect.appendChild(o);
  });
}

startCamBtn.onclick = async () => {
  if (stream) stream.getTracks().forEach(t => t.stop());
  stream = await navigator.mediaDevices.getUserMedia({
    video: { deviceId: { exact: cameraSelect.value } }
  });
  video.srcObject = stream;
  confirmBtn.disabled = false;
  statusText.textContent = "üì∏ S·∫µn s√†ng Spa";
};

confirmBtn.onclick = () => {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);
  socket.emit("action_ok", {
    action: "spa",
    image: canvas.toDataURL("image/jpeg")
  });
  statusText.textContent = "‚úÖ Spa OK ‚Äì ƒë√£ g·ª≠i";
};

loadCam();
</script>

</body>
</html>
